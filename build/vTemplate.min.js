/*
 *@name     vTemplate
 *@version  v0.1.0
 *@desc     An Easy Javascript Template.
 *@author   VeeQun
 *@license  MIT
 *@modified 2014-05-08
 */
!function(Global){function vTemplate(tpl){var that={},info={tpl:tpl.replace(/(\"|\')/gm,"\\$1").replace(/[\r\n]/gm,"")};return that.compile=function(){if("function"!=typeof that.render){var evalString=keyString.renderPrefix+__compile__(info.tpl)+keyString.renderPostfix;eval(evalString)}},that}function __compile__(stpl,config){var stplReg=consts.stplReg,step=null,oldIndex=0,compiled="",adding="";stplReg.lastIndex=0;var ignored=config&&config.ignored||[];consts.arrPush.apply(ignored,consts.keywords);for(var subStpl="",startFlag="",endFlag="",map=null,args="";step=stplReg.exec(stpl);)if(adding=stpl.slice(oldIndex,stplReg.lastIndex-step[0].length),compiled+=keyString.retPlus+keyString.quote+adding+keyString.quote+keyString.semicolon,oldIndex=stplReg.lastIndex,"="==step[1]){step[2]=step[2].replace(/\\\"/gm,'"');var kw=step[2].split(".")[0];compiled+=keyString.retPlus+(inArray(ignored,kw)?"":keyString.data_getter)+step[2]+keyString.semicolon}else if("@"==step[3]){if(subStpl=stpl.slice(oldIndex),startFlag=keyString.start+keyString.func+step[4],endFlag=keyString.end+keyString.func+step[4]+keyString.close,map=checkoutMap(startFlag,endFlag,subStpl),!map)throw"Something wrong with your template";var mapStpl=map[1];args="if"==step[4]?'"'+step[5]+'"':step[5].replace(consts.word,'"$1"'),eval("compiled+=helpers."+step[4]+"("+args+",mapStpl,ignored)"),stplReg.lastIndex=oldIndex+=map[0]}var tail=keyString.retPlus+keyString.quote+stpl.slice(oldIndex)+keyString.quote+keyString.semicolon;return compiled+tail}function inArray(a,b){if("indexOf"in a)return-1!==a.indexOf(b);for(var c=a.length;c;)if(a[--c]==b)return!0;return!1}function checkoutMap(a,b,c){for(var d,e,f=0,g=(a.length,b.length),h=c;-1!=(e=h.indexOf(b));){if(d=h.slice(0,e),f+=e+g,-1==d.indexOf(a))return[f,c.slice(0,f-g)];h=h.slice(e+g)}return!1}var randomNum=Math.random().toString(32).slice(2),consts={stplReg:/\<%(\=)\s*([a-zA-Z_$].*?)\s*\%\>|\<\%(\@)\s*([a-zA-Z_$]\w*?)\(\s*([^\r\n]*?)\s*\)\s*\%\>/gm,word:/((\w+)(?:\.\w+)*)/gm,arrPush:Array.prototype.push,keywords:["alert","break","case","catch","continue","debugger","default","delete","do","eval","else","finally","for","function","if","in","instanceof","new","return","switch","this","throw","try","typeof","var","void","while","with","Object","prototype","Array","Number","String","Boolean","Null","Undefined","RegExp","Function","window","console","arguments","setTimeout","setInterval","clearTimeout","clearInterval"],randomNum:randomNum,vtpl_ret:"vtpl_"+randomNum+"_ret",vtpl_data:"vtpl_"+randomNum+"_data"},keyString={renderPrefix:"that.render=function("+consts.vtpl_data+") {var "+consts.vtpl_ret+'="";',renderPostfix:";return "+consts.vtpl_ret+"}",retPlus:consts.vtpl_ret+"+=",data_getter:consts.vtpl_data+".",quote:"'",semicolon:";",close:"%>",start:"<%",end:"<%/",func:"@",echo:"="},helpers={count:0,k:"vtpl_k_"+consts.randomNum,c:"vtpl_c_"+consts.randomNum,l:"vtpl_l_"+consts.randomNum,each:function(a,b,c,d,e){{var f=helpers.k+helpers.count,g=helpers.c+helpers.count;helpers.l+helpers.count++}if(!c||!d){var h=!0;d=b}var i=h?[]:[b,c];consts.arrPush.apply(i,e);var j=__compile__(d,{ignored:i}),a=(inArray(i,a)?"":keyString.data_getter)+a,k="for(var "+f+"=0,"+g+"="+a+",len="+g+".length;"+f+"<len;"+f+"++){"+(h?"":"var "+b+"="+f+","+c+"="+g+"["+f+"];")+j+"}";return k},"if":function(a,b,c){var d=[];consts.arrPush.apply(d,c);var e=/((\w+)(?:\.\w+)*)|((\"|\')[^"']*?\4)/gm;a=a.replace(e,function(a,b,c,e){return inArray(d,c)||/^\d+$/.test(c)||e?a:keyString.data_getter+a});var f=__compile__(b,{ignored:c}),g="if("+a+"){"+f+"}";return g}};Global.vTemplate=vTemplate}(this);